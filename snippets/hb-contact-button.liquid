{% assign hana_contact_is_central = request.path contains '/pages/central-de-atendimento' %}

<button id="hana-contact-button"
        class="hana-contact-button"
        aria-label="Abrir Central Hana de Atendimento"
        onclick="window.location.href='/pages/central-de-atendimento'">
  ðŸ’¬ Atendimento
</button>

<style>
.hana-contact-button{
  position:fixed; bottom:16px; right:16px; z-index:9990;
  background:#c6a34f; color:#fff; border:none;
  padding:12px 18px; border-radius:28px;
  font-weight:600; box-shadow:0 3px 8px rgba(0,0,0,.15);
  letter-spacing:.3px; cursor:pointer;
  transition:transform .2s ease, box-shadow .2s ease, opacity .2s ease;
  opacity:0; pointer-events:none;
}
.hana-contact-button:hover{ transform:translateY(-2px); box-shadow:0 5px 12px rgba(0,0,0,.2); }
@media (max-width: 768px){ .hana-contact-button{ padding:10px 16px; font-size:.9rem; } }
</style>

{% if hana_contact_is_central %}
  <style>
    .hana-contact-button{display:none !important;}
  </style>
{% else %}
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      var button = document.getElementById('hana-contact-button');
      if (!button) { return; }

      window.dataLayer = window.dataLayer || [];
      window.gtag = window.gtag || function(){ dataLayer.push(arguments); };

      button.addEventListener('click', function(){
        if (typeof gtag === 'function') {
          gtag('event', 'contact_hub_open', {
            event_category: 'support',
            event_label: 'button_fixed'
          });
        }
      });

      var footer = document.querySelector('footer');

      function toggleButtonVisibility(){
        if (!button) { return; }
        if (!footer) {
          button.style.opacity = '1';
          button.style.pointerEvents = 'auto';
          return;
        }

        var footerTop = footer.getBoundingClientRect().top + window.scrollY;
        var viewportBottom = window.scrollY + window.innerHeight;
        if (viewportBottom > footerTop - 200) {
          button.style.opacity = '1';
          button.style.pointerEvents = 'auto';
        } else {
          button.style.opacity = '0';
          button.style.pointerEvents = 'none';
        }
      }

      toggleButtonVisibility();
      window.addEventListener('scroll', toggleButtonVisibility, { passive: true });
      window.addEventListener('resize', toggleButtonVisibility);
    });
  </script>
{% endif %}
